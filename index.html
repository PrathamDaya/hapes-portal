<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hapes Portal - Icon Edition</title>
    <style>
        /* ===== VARIABLES & THEME ===== */
        :root {
            --bg-primary: linear-gradient(135deg, #fceaff 0%, #fff0f5 100%);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --text-primary: #5c3b4c;
            --accent-color: #d94a6b;
            --accent-gradient: linear-gradient(45deg, #ff80a0, #d94a6b);
            --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            --border-color: #ffe0f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden; /* Prevent scroll from floating emojis */
            position: relative;
        }

        /* ===== FLOATING EMOJI BACKGROUND ===== */
        .floating-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .floating-emoji {
            position: absolute;
            font-size: 2em;
            opacity: 0.15;
            animation: float 10s linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.2; }
            90% { opacity: 0.2; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        /* ===== LAYOUT & CONTAINERS ===== */
        #appContainer { 
            max-width: 800px; 
            width: 100%; 
            position: relative; 
            z-index: 1; /* Above floating bg */
        }
        
        .screen { display: none; animation: fadeIn 0.4s ease; }
        .screen.active { display: block; }
        
        .container {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        button {
            background: var(--accent-gradient);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 10px rgba(217, 74, 107, 0.3);
        }

        /* ===== DIARY STYLES ===== */
        .diary-entry-list-item {
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #888;
        }

        .reply-section {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 3px solid var(--accent-color);
            font-size: 0.95em;
        }

        /* ===== GAME CANVAS STYLES ===== */
        .game-canvas-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--accent-color);
            touch-action: none;
        }

        canvas { width: 100%; height: 100%; display: block; }

        .game-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .score-board { font-size: 1.5em; font-weight: bold; color: var(--accent-color); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="floating-bg" id="floatingBg"></div>

<div id="appContainer">
    <section id="homeScreen" class="screen active">
        <div class="container" style="text-align: center;">
            <h1 style="color: var(--accent-color);">Hapes Portal</h1>
            <p style="margin: 20px 0; color: #888;">Select an activity</p>
            <div style="display: grid; gap: 15px; grid-template-columns: 1fr 1fr;">
                <button onclick="nav('diaryScreen')">üìñ Diary Portal</button>
                <button onclick="nav('slasherScreen')">üçâ Love Slasher</button>
                <button onclick="nav('catchScreen')">üíñ Catch Heart</button>
            </div>
        </div>
    </section>

    <section id="diaryScreen" class="screen">
        <div class="container">
            <header>
                <button onclick="nav('homeScreen')">üè† Home</button>
                <h2>Diary Entries</h2>
            </header>
            <div id="diaryList"></div>
            <div style="margin-top:20px; text-align: center;">
                <button onclick="addMockEntry()">+ Add Test Entry</button>
            </div>
        </div>
    </section>

    <section id="slasherScreen" class="screen">
        <div class="container">
            <header>
                <button onclick="stopGames(); nav('homeScreen')">‚ùå Exit</button>
                <div class="score-board">Score: <span id="slashScore">0</span></div>
            </header>
            <div class="game-canvas-container" id="slasherContainer">
                <canvas id="slasherCanvas"></canvas>
                <div id="slasherOverlay" class="game-overlay">
                    <h2>Love Slasher</h2>
                    <p>Swipe the fruit icons!</p>
                    <br>
                    <button onclick="initSlasher()">Start Game</button>
                </div>
            </div>
        </div>
    </section>

    <section id="catchScreen" class="screen">
        <div class="container">
            <header>
                <button onclick="stopGames(); nav('homeScreen')">‚ùå Exit</button>
                <div class="score-board">Score: <span id="catchScore">0</span></div>
            </header>
            <div class="game-canvas-container" id="catchContainer">
                <canvas id="catchCanvas"></canvas>
                <div id="catchOverlay" class="game-overlay">
                    <h2>Catch The Heart</h2>
                    <p>Catch the shiny heart icons!</p>
                    <br>
                    <button onclick="initCatchGame()">Start Game</button>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
    // ===== INIT: FLOATING EMOJIS =====
    document.addEventListener('DOMContentLoaded', () => {
        const bg = document.getElementById('floatingBg');
        const emojis = ['üíñ', 'üå∏', '‚ú®', 'ü¶ã', 'üíå', 'üê∞', 'üêº'];
        
        for (let i = 0; i < 20; i++) {
            const el = document.createElement('div');
            el.className = 'floating-emoji';
            el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            el.style.left = Math.random() * 100 + '%';
            el.style.animationDuration = (8 + Math.random() * 10) + 's';
            el.style.animationDelay = Math.random() * 5 + 's';
            bg.appendChild(el);
        }
    });

    // ===== NAVIGATION & UTILS =====
    let currentGameLoop = null;

    function nav(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
        if(screenId === 'diaryScreen') renderDiary();
    }

    function stopGames() {
        if (currentGameLoop) cancelAnimationFrame(currentGameLoop);
        currentGameLoop = null;
    }

    // ===== DIARY COMPONENT =====
    let diaryData = JSON.parse(localStorage.getItem('hapesDiary')) || [
        { id: 1, date: '2025-07-20', author: 'Chikoo', text: 'I really missed you today. The weather was rainy and it reminded me of our first date.', replies: [] }
    ];

    function saveDiary() { localStorage.setItem('hapesDiary', JSON.stringify(diaryData)); }

    function addMockEntry() {
        diaryData.push({
            id: Date.now(),
            date: new Date().toISOString().split('T')[0],
            author: 'Prath',
            text: 'Just adding a test entry to check the portal rendering!',
            replies: []
        });
        saveDiary();
        renderDiary();
    }

    function renderDiary() {
        const list = document.getElementById('diaryList');
        list.innerHTML = '';

        if (diaryData.length === 0) {
            list.innerHTML = '<p style="text-align:center">No entries yet.</p>';
            return;
        }

        diaryData.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(entry => {
            const el = document.createElement('div');
            el.className = 'diary-entry-list-item';
            
            let repliesHtml = '';
            if(entry.replies && entry.replies.length > 0) {
                repliesHtml = entry.replies.map(r => 
                    `<div class="reply-section"><strong>Response:</strong> ${r.text}</div>`
                ).join('');
            }

            el.innerHTML = `
                <div class="entry-header">
                    <span>üìÖ ${entry.date}</span>
                    <span>‚úçÔ∏è ${entry.author}</span>
                </div>
                <div class="entry-content">${entry.text}</div>
                ${repliesHtml}
                <div style="text-align: right; margin-top: 10px;">
                    <button style="font-size: 0.8em; padding: 5px 15px; background: #6c757d;" onclick="openReply(${entry.id})">üí¨ Reply</button>
                </div>
            `;
            list.appendChild(el);
        });
    }

    function openReply(id) {
        const text = prompt("Enter your reply message:");
        if (text) {
            const entry = diaryData.find(e => e.id === id);
            if (entry) {
                if (!entry.replies) entry.replies = [];
                entry.replies.push({ text: text, date: new Date().toISOString() });
                saveDiary();
                renderDiary();
            }
        }
    }

    // ===== CANVAS GRAPHICS: EMOJI ICONS =====
    function drawIconBubble(ctx, x, y, radius, color, emoji) {
        ctx.save();
        
        // 1. Draw Background Bubble
        ctx.shadowColor = "rgba(0,0,0,0.2)";
        ctx.shadowBlur = 10;
        ctx.shadowOffsetY = 5;
        
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fill();

        // 2. Draw Glossy Highlight (Top Left)
        ctx.shadowColor = "transparent";
        ctx.fillStyle = "rgba(255,255,255,0.3)";
        ctx.beginPath();
        ctx.arc(x - radius*0.3, y - radius*0.3, radius*0.4, 0, Math.PI * 2);
        ctx.fill();

        // 3. Draw Emoji centered
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.font = `${radius * 1.2}px Arial`; // Scale emoji to fit bubble
        ctx.fillText(emoji, x, y + (radius * 0.1)); // Slight offset for vertical centering
        
        ctx.restore();
    }

    // ===== GAME 1: LOVE SLASHER (ICON EDITION) =====
    function initSlasher() {
        document.getElementById('slasherOverlay').style.display = 'none';
        const canvas = document.getElementById('slasherCanvas');
        const parent = document.getElementById('slasherContainer');
        canvas.width = parent.clientWidth;
        canvas.height = parent.clientHeight;
        const ctx = canvas.getContext('2d');
        
        let score = 0;
        let objects = [];
        let particles = [];
        let trail = [];
        let frame = 0;
        
        document.getElementById('slashScore').textContent = '0';

        function track(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            trail.push({ x: clientX - rect.left, y: clientY - rect.top, life: 8 });
        }
        canvas.addEventListener('mousemove', track);
        canvas.addEventListener('touchmove', track, {passive: false});

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            frame++;

            if (frame % 45 === 0) {
                // Define Fruits with Background Colors
                const types = [
                    { type: 'watermelon', color: '#ffadad', emoji: 'üçâ' },
                    { type: 'orange', color: '#ffd6a5', emoji: 'üçä' },
                    { type: 'kiwi', color: '#caffbf', emoji: 'ü•ù' },
                    { type: 'bomb', color: '#4a4e69', emoji: 'üí£' }
                ];
                const item = types[Math.floor(Math.random() * types.length)];
                
                objects.push({
                    x: Math.random() * (canvas.width - 60) + 30,
                    y: canvas.height + 50,
                    vx: (Math.random() - 0.5) * 5,
                    vy: -(Math.random() * 6 + 10),
                    radius: 35,
                    ...item
                });
            }

            // Draw Trail
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.beginPath();
            for(let i=0; i<trail.length-1; i++) {
                ctx.moveTo(trail[i].x, trail[i].y);
                ctx.lineTo(trail[i+1].x, trail[i+1].y);
            }
            ctx.stroke();
            trail.forEach(t => t.life--);
            trail = trail.filter(t => t.life > 0);

            // Update Objects
            for (let i = objects.length - 1; i >= 0; i--) {
                let obj = objects[i];
                obj.x += obj.vx;
                obj.y += obj.vy;
                obj.vy += 0.25;

                // Draw Object as Icon
                drawIconBubble(ctx, obj.x, obj.y, obj.radius, obj.color, obj.emoji);

                // Collision Detection
                let hit = false;
                for(let t of trail) {
                    let dx = t.x - obj.x;
                    let dy = t.y - obj.y;
                    if (Math.sqrt(dx*dx + dy*dy) < obj.radius) {
                        hit = true; break;
                    }
                }

                if (hit) {
                    if (obj.type === 'bomb') {
                        stopGames();
                        alert("BOOM! You hit a bomb icon!");
                        document.getElementById('slasherOverlay').style.display = 'flex';
                        return;
                    } else {
                        score++;
                        document.getElementById('slashScore').textContent = score;
                        // Explosion particles
                        for(let p=0; p<8; p++) {
                            particles.push({
                                x: obj.x, y: obj.y,
                                vx: (Math.random()-0.5)*12, vy: (Math.random()-0.5)*12,
                                life: 20, color: obj.color
                            });
                        }
                        objects.splice(i, 1);
                        continue;
                    }
                }
                if (obj.y > canvas.height + 60) objects.splice(i, 1);
            }

            // Particles
            for(let i=particles.length-1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.life--;
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI*2); ctx.fill();
                if(p.life <= 0) particles.splice(i, 1);
            }

            currentGameLoop = requestAnimationFrame(loop);
        }
        loop();
    }

    // ===== GAME 2: CATCH THE HEART (ICON EDITION) =====
    function initCatchGame() {
        document.getElementById('catchOverlay').style.display = 'none';
        const canvas = document.getElementById('catchCanvas');
        const parent = document.getElementById('catchContainer');
        canvas.width = parent.clientWidth;
        canvas.height = parent.clientHeight;
        const ctx = canvas.getContext('2d');

        let score = 0;
        let hearts = [];
        let basket = { x: canvas.width/2, w: 70, h: 40 };
        let frame = 0;

        document.getElementById('catchScore').textContent = '0';

        function moveBasket(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            let clientX = e.touches ? e.touches[0].clientX : e.clientX;
            basket.x = clientX - rect.left - basket.w/2;
        }
        canvas.addEventListener('mousemove', moveBasket);
        canvas.addEventListener('touchmove', moveBasket, {passive: false});

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            frame++;

            // Draw Basket (Rounded Box)
            ctx.fillStyle = '#8d99ae';
            ctx.beginPath();
            ctx.roundRect(basket.x, canvas.height - 50, basket.w, basket.h, 10);
            ctx.fill();
            // Basket label
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText('üß∫', basket.x + basket.w/2, canvas.height - 25);

            // Spawn Hearts
            if (frame % 35 === 0) {
                const isBad = Math.random() > 0.8;
                hearts.push({
                    x: Math.random() * (canvas.width - 30),
                    y: -30,
                    radius: 20 + Math.random() * 5,
                    speed: 2 + Math.random() * 3,
                    type: isBad ? 'bad' : 'good',
                    color: isBad ? '#343a40' : '#ffc8dd', // Dark Gray vs Soft Pink
                    emoji: isBad ? 'üíî' : 'üíñ'
                });
            }

            for(let i=hearts.length-1; i>=0; i--) {
                let h = hearts[i];
                h.y += h.speed;

                // Draw Heart as Icon Bubble
                drawIconBubble(ctx, h.x, h.y, h.radius, h.color, h.emoji);

                // Catch Logic
                if (h.y > canvas.height - 50 && h.y < canvas.height && 
                    h.x > basket.x - 20 && h.x < basket.x + basket.w + 20) {
                    
                    if(h.type === 'bad') {
                        score -= 5; // Penalty
                    } else {
                        score++;
                    }
                    document.getElementById('catchScore').textContent = score;
                    hearts.splice(i, 1);
                }
                else if (h.y > canvas.height) {
                    hearts.splice(i, 1);
                }
            }
            currentGameLoop = requestAnimationFrame(loop);
        }
        loop();
    }
</script>
</body>
</html>
